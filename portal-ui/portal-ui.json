{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "isWizard": false,
            "title": "Azure Virtual Desktop - Replacement Plans Deployment",
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "Microsoft.DesktopVirtualization/HostPools"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "RequiredParametersStep",
                    "label": "Required Parameters",
                    "elements": [
                        {
                            "name": "HostPoolSelector",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "label": "Select target Host Pool",
                            "resourceType": "Microsoft.DesktopVirtualization/HostPools",
                            "constraints": {
                                "required": true
                            },
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            }
                        },
                        {
                            "name": "sessionHostsCount",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Target Session Host Count",
                            "toolTip": "The target number of session hosts in the host pool.",
                            "defaultValue": 10,
                            "constraints": {
                                "required": true,
                                "regex": "^\\d+$",
                                "validationMessage": "Must be an integer."
                            }
                        },
                        {
                            "name": "sessionHostNamePrefix",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Session Host Name Prefix",
                            "toolTip": "The prefix for the session host names. The session host names will be in the format <prefix>-<number>.",
                            "constraints": {
                                "required": true,
                                "regex": "^\\d+15$",
                                "validationMessage": "Must be a valid name less than 12 characters long to allow for the 3 character suffix (eg. prefix-01)."
                            }
                        },
                        {
                            "name": "TemplateParameters",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Template Parameters",
                            "toolTip": "The parameters to pass to the template at deployment time. Use json format.",
                            "multiLine": true,
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "EntraJoined",
                            "type": "Microsoft.Common.CheckBox",
                            "label": "Session hosts are Entra Joined (Azure AD Joined)",
                            "toolTip": "If the session hosts are Entra Joined, Replacement Plan will attempt to delete its device object from Entra ID. This requires additional permissions to be granted to the service principal used by Replacement Plan. Please refer to the documentation for more information.",
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "EntraJoinedInfoBox",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('RequiredParametersStep').EntraJoined]",
                            "options": {
                                "icon": "Warning",
                                "text": "When the VMs are Entra Joined, Replacement Plan will attempt to delete its device object from Entra ID. This requires additional permissions to be granted to the service principal used by Replacement Plan. Please refer to the documentation for more information.",
                                "uri": "https://www.microsoft.com"
                            }
                        }
                    ]
                },
                {
                    "name": "optionalParametersStep",
                    "label": "Optional Parameters",
                    "elements": [
                        {
                            "name": "_Tag_IncludeInAutomation",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Include in Automation Tag Name",
                            "toolTip": "The name of the tag to use to determine if an existing session host should be included in the automation. If the tag is present and set to 'true', the session host will be included. If the tag is not present or set to 'false', the session host will be excluded.",
                            "defaultValue": "IncludeInAutoReplace",
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "_Tag_DeployTimestamp",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Deploy Timestamp Tag Name",
                            "toolTip": "The name of the tag to use to determine when the session host was deployed. This is updated by the replacement plan function on new session hosts. You can edit this value to force replace a VM.",
                            "defaultValue": "AutoReplaceDeployTimestamp",
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "_Tag_PendingDrainTimestamp",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Pending Drain Timestamp Tag Name",
                            "toolTip": "The name of the tag to use to determine when the session host was marked for drain. This is updated by the replacement plan function on hosts pending deletion.",
                            "defaultValue": "AutoReplacePendingDrainTimestamp",
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "_Tag_ScalingPlanExclusionTag",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Scaling Plan Exclusion Tag Name",
                            "toolTip": "The name of the tag Replacement Plan will set to exclude a session host from scaling plans actions.",
                            "defaultValue": "ScalingPlanExclusion",
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "_TargetVMAgeDays",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Target VM Age (Days)",
                            "toolTip": "The maximum age of a VM in days before it is replaced. This is compared to the value of the Deploy Timestamp Tag.",
                            "defaultValue": 45,
                            "constraints": {
                                "required": false
                            }
                        },
                        {
                            "name": "_DrainGracePeriodHours",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Drain Grace Period (Hours)",
                            "toolTip": "The number of hours to wait after marking a VM for drain before deleting it. This is to allow users to finish their sessions before the VM is deleted.",
                            "defaultValue": 24,
                            "constraints": {
                                "required": false
                            }
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "deploymentPrefix": "[steps('RequiredParametersStep').HostPoolSelector]"
            },
            "kind": "ResourceGroup",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}